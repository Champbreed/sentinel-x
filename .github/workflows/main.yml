name: Sentinel-X Security Gate
on: [push]

jobs:
  governance-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: OPA Policy Audit
        run: |
          docker run --rm -v ${{ github.workspace }}:/work openpolicyagent/opa check /work/policies/authz.rego --v1-compatible

  secret-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1
      - name: TruffleHog OSS
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          base: ${{ github.event.repository.default_branch }}
          head: HEAD
          extra_args: --only-verified --fail=high

  deploy:
    needs: [governance-check, secret-scan]
    runs-on: ubuntu-latest
    steps:
      - name: Deploy
        run: echo "Security gates passed. System Secure."

# Build Verified: Thu Dec 25 09:30:35 WAT 2025
